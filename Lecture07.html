<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Rendering on Game Engine - GAMES104 现在游戏引擎理论与实践</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="The note of GAMES104">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/pagetoc.css">
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">基础构建</li><li class="chapter-item expanded "><a href="Architecutre.html"><strong aria-hidden="true">2.</strong> 分层架构</a></li><li class="chapter-item expanded "><a href="world.html"><strong aria-hidden="true">3.</strong> 如何构建游戏世界</a></li><li class="chapter-item expanded "><a href="Render/intro.html"><strong aria-hidden="true">4.</strong> 渲染</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Render/practice.html"><strong aria-hidden="true">4.1.</strong> 如何高效渲染网格、材质与纹理</a></li><li class="chapter-item expanded "><a href="Physical-BasedMaterial.html"><strong aria-hidden="true">4.2.</strong> Physical-Based Material</a></li><li class="chapter-item expanded "><a href="Image-BasedLighting(IBL).html"><strong aria-hidden="true">4.3.</strong> Image-Based Lighting (IBL)</a></li><li class="chapter-item expanded "><a href="Lecture06.html"><strong aria-hidden="true">4.4.</strong> Modern Game Engine - Theory and Practice</a></li><li class="chapter-item expanded "><a href="Lecture07.html" class="active"><strong aria-hidden="true">4.5.</strong> Rendering on Game Engine</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">GAMES104 现在游戏引擎理论与实践</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/CaterpillarStudyGroup/GAMES104_mdbook" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main><div class="sidetoc"><nav class="pagetoc"></nav></div>
                        <p>P34</p>
<h2 id="post-process"><a class="header" href="#post-process">Post-process</a></h2>
<p>Post-process in 3D Graphics refers to any algorithm that will be applied to the final image. It can be done for stylistic reasons (color correction, contrast, etc.) or for realistic reasons (tone mapping, depth of field, etc.)</p>
<p><img src="./assets/07-24.png" alt="" /></p>
<p>P35</p>
<h2 id="bloom-effect"><a class="header" href="#bloom-effect">Bloom Effect</a></h2>
<p>P36</p>
<h2 id="what-is-bloom"><a class="header" href="#what-is-bloom">What is Bloom</a></h2>
<ul>
<li>The physical basis of bloom is that, in the real world, lenses can never focus perfectly</li>
<li>Even a perfect lens will convolve the incoming image with an <u><strong>Airy disk</strong></U></li>
</ul>
<p><img src="./assets/07-25.png" alt="" /></p>
<p>P37</p>
<h2 id="detect-bright-area-by-threshold"><a class="header" href="#detect-bright-area-by-threshold">Detect Bright Area by Threshold</a></h2>
<p><img src="./assets/07-26.png" alt="" /></p>
<p>Find Luminance (Y) apply the standard coefficients for sRGB:</p>
<p>$$
Y=R_{lin}\ast 0.2126+G_{lin}\ast 0.7152+B_{lin}\ast 0.0722
$$</p>
<blockquote>
<p>取出非常亮的部分，做与 5\(\times \)5 高斯 blur。</p>
</blockquote>
<p>P38</p>
<h2 id="gaussian-blur"><a class="header" href="#gaussian-blur">Gaussian Blur</a></h2>
<p><img src="./assets/07-27.png" alt="" /></p>
<p>P39</p>
<h2 id="pyramid-guassian-blur"><a class="header" href="#pyramid-guassian-blur">Pyramid Guassian Blur</a></h2>
<p><img src="./assets/07-28.png" alt="" /></p>
<p>We can't do all that filtering at high resolution, so we need a way to <strong>downsample</strong> and <strong>upsample</strong> the image Need a weight coefficient to tweak final effect</p>
<blockquote>
<p>在低精度图上 blur 再放大，可以得到大区域的 blur 效果同时较小的计算量。</p>
</blockquote>
<p>P40</p>
<h2 id="bloom-composite"><a class="header" href="#bloom-composite">Bloom Composite</a></h2>
<p><img src="./assets/07-29.png" alt="" /></p>
<p>P41<br />
<img src="./assets/07-30.png" alt="" /></p>
<p>P42</p>
<h2 id="tone-mapping"><a class="header" href="#tone-mapping">Tone Mapping</a></h2>
<blockquote>
<p>真实世界的亮度 range 非常大，如果曝光没调好，会出现亮部过亮或暗部过暗的效果。</p>
</blockquote>
<p>P43</p>
<h2 id="tone-mapping-1"><a class="header" href="#tone-mapping-1">Tone Mapping</a></h2>
<ul>
<li>No way to directly display HDR image in a SDR device</li>
<li>The purpose of the <strong>Tone Mapping</strong> function is to map the wide range of high dynamic range (HDR) colors into standard dynamic range (SDR) that a display can output</li>
</ul>
<p><img src="./assets/07-31.png" alt="" /></p>
<blockquote>
<p>用一条曲线把 HDR 映射到 SDR。<br />
filmic curve 是一个拟合出来的所项式曲线。</p>
</blockquote>
<p>P45</p>
<h2 id="aces"><a class="header" href="#aces">ACES</a></h2>
<ul>
<li><strong>A</strong>cademy <strong>C</strong>olor <strong>E</strong>ncoding <strong>S</strong>ystem
<ul>
<li>Primarily for Film &amp; Animation</li>
<li>Interesting paradigms and transformations</li>
</ul>
</li>
<li>The useful bits
<ul>
<li>Applying Color Grading in HDR is good</li>
<li>The idea of a fixed pipeline up to the final OTD transforms stage is good
<ul>
<li>Separates artistic intent from the mechanics of supporting different devices</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="./assets/07-32-1.png" alt="" /></p>
<blockquote>
<p>ACES 曲线不但效果更好，还可以通注增加一个后处理，无差别适配到任何终端。</p>
</blockquote>
<p>P46</p>
<h2 id="hdr-and-sdr-pipeline"><a class="header" href="#hdr-and-sdr-pipeline">HDR and SDR Pipeline</a></h2>
<ul>
<li>Visual consistency between HDR / SDR</li>
<li>Similar SDR results to previous SDR color pipeline</li>
<li>High quality</li>
<li>High performance</li>
<li>Minimal disruption to art teams
<ul>
<li>Simple transition from current color pipeline</li>
<li>Minimal additional overhead for mastering HDR <em>and</em> SDR</li>
</ul>
</li>
</ul>
<p><img src="./assets/07-33.png" alt="" /></p>
<p>P47</p>
<h2 id="tone-mapping-curve-comparison"><a class="header" href="#tone-mapping-curve-comparison">Tone Mapping Curve Comparison</a></h2>
<p><img src="./assets/07-34-1.png" alt="" /><br />
<img src="./assets/07-34-2.png" alt="" /></p>
<p>P48</p>
<h2 id="color-grading"><a class="header" href="#color-grading">Color Grading</a></h2>
<p>P49</p>
<h2 id="lookup-table-lut"><a class="header" href="#lookup-table-lut">Lookup Table (LUT)</a></h2>
<ul>
<li>
<p>LUT is used to remap the input color values of source pixels to new output values based on data contained within the LUT</p>
</li>
<li>
<p>A LUT can be considered as a kind of color preset that can be applied to image or footage</p>
</li>
</ul>
<p><img src="./assets/07-35.png" alt="" /> </p>
<blockquote>
<p>用一个表格实现从原始色相空间到目标色相空间的映射。</p>
</blockquote>
<p>P53</p>
<h2 id="rendering-pipeline"><a class="header" href="#rendering-pipeline">Rendering Pipeline</a></h2>
<p>P59</p>
<h2 id="rendering-pipeline-1"><a class="header" href="#rendering-pipeline-1">Rendering Pipeline</a></h2>
<ul>
<li><strong>Rendering pipeline</strong> is the management order of all rendering operation execution and resource allocation</li>
</ul>
<p><img src="./assets/07-36.png" alt="" /> </p>
<p>P60</p>
<h2 id="forward-rendering"><a class="header" href="#forward-rendering">Forward Rendering</a></h2>
<p>for n meshes<br />
\(\quad\) for m lights<br />
\(\quad \quad\)color += shading(mesh, light)</p>
<p>P61</p>
<h2 id="sort-and-render-transparent-after-opaque-objects"><a class="header" href="#sort-and-render-transparent-after-opaque-objects">Sort and Render Transparent after Opaque Objects</a></h2>
<p><img src="./assets/07-37.png" alt="" /> </p>
<blockquote>
<p>透明物质必须最后绘制。<br />
多个透明物质则由远及近绘制，因为不同绘制顺序产生的结果是不一样的。<br />
透明物体的排序很容易引起各种 BuG。<br />
十几年前的主流 Pipeline。</p>
</blockquote>
<p>P64</p>
<h2 id="deferred-rendering"><a class="header" href="#deferred-rendering">Deferred Rendering</a></h2>
<p><img src="./assets/07-38-1.png" alt="" /></p>
<p><img src="./assets/07-38-2.png" alt="" /> </p>
<p><img src="./assets/07-38-3.png" alt="" /> </p>
<p><img src="./assets/07-38-4.png" alt="" /> </p>
<blockquote>
<p>由于光的种类非常复杂，引入延迟渲染技术，即先绘制物体，再考虑与光的关系。<br />
近十年最主流的 Pipeline.</p>
</blockquote>
<p>P65</p>
<h2 id="deferred-rendering-1"><a class="header" href="#deferred-rendering-1">Deferred Rendering</a></h2>
<p><strong>Pros</strong></p>
<ul>
<li>Lighting is only computed for visible fragments</li>
<li>The data from the G-Buffer can be used for post- processing</li>
</ul>
<p><strong>Cons</strong></p>
<ul>
<li>High memory and bandwidth cost</li>
<li>Not supporting transparent object</li>
<li>Not friendly to MSAA</li>
</ul>
<p><img src="./assets/07-39.png" alt="" /></p>
<p>P66</p>
<h2 id="pilot-engine-deferred-rendering"><a class="header" href="#pilot-engine-deferred-rendering">Pilot Engine Deferred Rendering</a></h2>
<p><img src="./assets/07-40.png" alt="" /></p>
<p>P67</p>
<h2 id="tile-based-rendering"><a class="header" href="#tile-based-rendering">Tile-based Rendering</a></h2>
<p><img src="./assets/07-41-1.png" alt="" /></p>
<p><img src="./assets/07-41-2.png" alt="" /></p>
<p><img src="./assets/07-41-3.png" alt="" /></p>
<blockquote>
<p>这个 pipeline 用于移动端。因为移动端最关心发热问题。<br />
DRAM 存储大、速度慢、功耗高。On-chip 中的 SRAM 则相反。<br />
因此，把整个 G-buffer 切成小的 tile 在 SRAM 计算，算好存成framebuffer。</p>
</blockquote>
<p>P68</p>
<h2 id="light-culling-by-tiles"><a class="header" href="#light-culling-by-tiles">Light Culling by Tiles</a></h2>
<p><img src="./assets/07-42.png" alt="" /></p>
<p>P69</p>
<h2 id="depth-range-optimization"><a class="header" href="#depth-range-optimization">Depth Range Optimization</a></h2>
<ul>
<li>Get Min/Max depth per tile from Pre-z pass</li>
<li>Test depth bounds for each light</li>
</ul>
<p><img src="./assets/07-43.png" alt="" /></p>
<blockquote>
<p>tile-based 是现代引擎的主流方案。<br />
tile 的额外好处是简化光的计算。</p>
</blockquote>
<p>P71</p>
<h2 id="forward-tile-based-forward-rendering"><a class="header" href="#forward-tile-based-forward-rendering">Forward+ (Tile-based Forward) Rendering</a></h2>
<ul>
<li>Depth prepass (prevent overdraw / provide tile depth bounds)</li>
<li>Tiled light culling (output: light list per tile)</li>
<li>Shading per object (PS: Iterate through light list calculated in light culling)</li>
</ul>
<p>P72</p>
<h2 id="cluster-based-rendering"><a class="header" href="#cluster-based-rendering">Cluster-based Rendering</a></h2>
<p><img src="./assets/07-44.png" alt="" /></p>
<blockquote>
<p>对 Z 空间也做切分。一个小块称为 cluster。</p>
</blockquote>
<p>P73</p>
<h2 id="visibility-buffer"><a class="header" href="#visibility-buffer">Visibility Buffer</a></h2>
<p><img src="./assets/07-45.png" alt="" /></p>
<blockquote>
<p>几何信息 (V-Buffer) 和材质信息 (G-Buffer) 剥离开。<br />
因为现在的几何越来越复杂，甚至几何密度超过像素密度。<br />
这是现代引擎的发展方向。</p>
</blockquote>
<p>P74<br />
<img src="./assets/07-46.png" alt="" /></p>
<p>P75</p>
<h2 id="challenges"><a class="header" href="#challenges">Challenges</a></h2>
<ul>
<li>Complex parallel work needs to synchronize with complex resource dependency</li>
<li>Large amount of transient resource whose lifetime is shorter than one frame</li>
<li>Complex resource state management</li>
<li>Exploit newly exposed GPU features without extensive user low level knowledge</li>
</ul>
<p>P76</p>
<h2 id="frame-graph"><a class="header" href="#frame-graph">Frame Graph</a></h2>
<p>A Directed Acyclic Graph (DAG) of pass and resource dependency in a frame, not a real visual graph</p>
<p><img src="./assets/07-47.png" alt="" /></p>
<blockquote>
<p>Frame Graph 是未来重要的发展方向。</p>
</blockquote>
<p>P77</p>
<h2 id="render-to-monitor"><a class="header" href="#render-to-monitor">Render to Monitor</a></h2>
<p>P78</p>
<h2 id="screen-tearing"><a class="header" href="#screen-tearing">Screen Tearing</a></h2>
<p><img src="./assets/07-48.png" alt="" /></p>
<p>P79</p>
<h2 id="screen-tearing-1"><a class="header" href="#screen-tearing-1">Screen Tearing</a></h2>
<p>In most games your GPU frame rate will be highly volatile<br />
When new GPU frame updates in the middle of last screen frame, screen tearing occurrs</p>
<p><img src="./assets/07-49.png" alt="" /></p>
<p>P80</p>
<h2 id="v-sync-technology"><a class="header" href="#v-sync-technology">V-Sync Technology</a></h2>
<p>Synchronizing buffer swaps with the Vertical refresh is called V-sync<br />
V-Sync can be used to prevent tearing but framerates are reduced, the mouse is lagging &amp; stuttering ruins gameplay</p>
<p><img src="./assets/07-50.png" alt="" /></p>
<p>P81</p>
<h2 id="variable-refresh-rate"><a class="header" href="#variable-refresh-rate">Variable Refresh Rate</a></h2>
<p><img src="./assets/07-51.png" alt="" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="Lecture06.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="Lecture06.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="theme/pagetoc.js"></script>
    </body>
</html>
